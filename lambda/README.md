# AWS Lambda handler

This folder contains the Python code deployed on AWS Lambda that saves the visit record in to the MongoDB.

## Deploying the project

1. Add a secret in GitHub, with the name `MONGO_SECRETS`, and in the format:
```
MONGO_USERNAME=
MONGO_PASSWORD=
MONGO_HOST=
MONGO_DATABASE_NAME=
```
2. Run the `Build package for deploying to Lambda` workflow from GitHub Action
3. Download the artifact (.zip) generated by the workflow, and upload the file to Lambda

## Schemas

This sections shows the MongoDB validation rules that are currently in use. All the requests made to the Lambda function needs to contain the fields required.

Schema for page visits
``` json
"$jsonSchema": {
    "bsonType": "object",
    "required": ["_id", "datetime", "host", "path", "ip", "country"],
    "properties": {
        "_id": {
            "bsonType": "objectId",
        },
        "datetime": {
            "bsonType": "date",
        },
        "host": {
            "bsonType": "string",
        },
        "path": {
            "bsonType": "string",
        },
        "ip": {
            "bsonType": "string",
        },
        "country": {
            "bsonType": "string",
        },
    },
    "additionalProperties": False,
}
```

Schema for external url visits
``` json
"$jsonSchema": {
    "bsonType": "object",
    "required": ["_id", "datetime", "host", "path", "ip", "externalUrl"],
    "properties": {
        "_id": {
            "bsonType": "objectId",
        },
        "datetime": {
            "bsonType": "date",
        },
        "host": {
            "bsonType": "string",
        },
        "path": {
            "bsonType": "string",
        },
        "ip": {
            "bsonType": "string",
        },
        "externalUrl": {
            "bsonType": "string",
        },
    },
    "additionalProperties": False,
}
```
