# AWS Lambda handler

**(UNDER DEVELOPMENT)**

This folder contains the Python code deployed on AWS Lambda that saves the visit record in to the MongoDB.

It support two type of visit records:

1. Page visits: Logging each page the user visited in the web site
2. External url visits: Logging the links to external web sites that the user has clicked

New functions planning to be added:
1. Logging which buttons the user clicked on
2. Logging the time user spent on each page

## Deploying the project

1. Add a secret in GitHub, with the name `MONGO_SECRETS`, and in the format:
```
MONGO_USERNAME=
MONGO_PASSWORD=
MONGO_HOST=
MONGO_DATABASE_NAME=
```
2. Run the `Python application` from GitHub Action
3. Download the artifact (.zip) generated by the workflow, and upload the file to Lambda

## Schemas

This sections shows the MongoDB validation rules that are currently in use. All the requests made to the Lambda function needs to contain the fields required.

Schema for page visits
``` json
"$jsonSchema": {
    "bsonType": "object",
    "required": ["datetime", "host", "path", "ip", "country"],
    "properties": {
        "datetime": {
            "bsonType": "date",
        },
        "host": {
            "bsonType": "string",
        },
        "path": {
            "bsonType": "string",
        },
        "ip": {
            "bsonType": "string",
        },
        "country": {
            "bsonType": "string",
        },
    },
}
```

Schema for external url visits
``` json
"$jsonSchema": {
    "bsonType": "object",
    "required": ["datetime", "host", "path", "ip", "country", "externalUrl"],
    "properties": {
        "datetime": {
            "bsonType": "date",
        },
        "host": {
            "bsonType": "string",
        },
        "path": {
            "bsonType": "string",
        },
        "ip": {
            "bsonType": "string",
        },
        "country": {
            "bsonType": "string",
        },
        "externalUrl": {
            "bsonType": "string",
        },
    },
}
```
